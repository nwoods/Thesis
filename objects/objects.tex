%!TEX root = ../nwoods_thesis.tex

\chapter{Object Reconstruction and Selection}

The raw detector information stored on disk after an event passes trigger selections is not yet suitable for physics analysis.
Hits in the tracker and muon systems, and energy deposits in the calorimeters, require significant processing to build physics objects that are interpretable in terms of the physics of the hard scatter.
Patterns in the tracker and muon system hits are found and used to construct charged particle and muon tracks, and energy deposits in the calorimeters are grouped into clusters.
Final state particles that interact with CMS are reconstructed from the tracks and calorimeter clusters, final state particles are clustered into jets, charged particles are clustered by track origin to find proton-proton collision vertices, and visible particle momenta are summed to find the transverse momentum imbalance from undetectable particles (e.g.\ neutrinos).
The resulting physics objects undergo selection to determine which represent real particles of interest for the analysis.
Selected particles are used to reconstruct the hard interaction from the collision---in the analyses presented here, leptons are paired to form $\PZ/\Pa^\ast$ boson candidates which may be paired to form Higgs or {\PZ} boson candidates, and jets are used to distinguish electroweak and QCD {\ZZ} production.


\section{Track Reconstruction and Vertex Identification}\label{sec:trkVtxReco}

Tracks are reconstructed in the inner tracker by iterative application of a combinatorial Kalman filter algorithm~\cite{Fruhwirth:1987fm,Billoir:1990we,Adam:2005cg,Chatrchyan:2014fea}.
At each iteration, tracks found in the pixel detector are used as ``seeds'', track segments which serve as the initial trajectories on which strip tracker hits from the same particle are expected.
The pixel seed supplies the initial parameters for the combinatorial Kalman filter.
At each tracker layer, the algorithm predicts where the particle will hit the next layer based on the track's current parameters, taking into account the effects of particle interaction with tracker material.
The extrapolated trajectory is used to find compatible hits in the next layer with a $\chi^2$ test, and if possible the most compatible hit is added to the track and its parameters are updated accordingly.
If no hits are compatible, a ``ghost'' hit which does not contribute to the track parameters may be added to account for the possibility of a missing hit in the corresponding layer.
This procedure is repeated recursively at each tracker layer, from the innermost layer past the seed to the outermost layer of the silicon strip tracker.
If two tracks found in an iteration share too many hits, they are assumed to be from the same particle and the one with fewer hits is rejected, using the total $\chi^2$ of all hits as a tiebreaker.
The first iterations of the track finding algorithm searches for high-$\pt$ tracks from primary proton-proton interactions, which are easier to find because they are close to straight and originate from the beam line.
When a track is found, its constituent hits are removed from consideration in future iterations, reducing the computational complexity of finding the more difficult tracks from lower-$\pt$ particles and products of $\Pqb$~hadron decays which happen away from the beam line.

Because the Kalman filter obtains the final track parameters only at the outermost tracker layer, each track is refit and smoothed with further Kalman filters, improving track quality and reducing fake rate.
Spurious tracks are rejected from the final collection with requirements on the number of layers hit, the $\chi^2$ of the fit, and compatibility with a primary vertex.LHC
The efficiency for reconstructing tracks of all prompt charged particles with $\pt > 900\MeV$ is around 94\% in the barrel and 85\% in the endcap; for isolated muons, it is virtually 100\% in the whole tracker acceptance~\cite{Chatrchyan:2014fea}.

Electrons lose substantially more energy to interactions with the tracker material than other charged particles, often breaking the assumption of Gaussian energy loss inherent to the Kalman filter.
To mitigate the impact of the resulting poor track fits, tracks with many missing hits or a poor $\chi^2$ are refit using a Gaussian sum filter (GSF)~\cite{Adam:2005bya}.
Any Kalman filter or GSF tracks with trajectories that intersect ECAL energy clusters (see below) are considered electron track candidates and refit with a second, more complicated GSF\@.
This GSF track collection is used as inputs to the PF electron reconstruction described below.

Proton-proton interaction vertices are found by clustering tracks by minimizing the figure of merit
\begin{equation}\label{eq:vtxChi2}
  \chi^2 = \sum_i \sum_j p_{ij} \frac{\left(z^t_j - z^V_i\right)^2}{\sigma_{j}^2},
\end{equation}
where $z^V_i$ is the $z$ position of vertex $i$, $z^t_j$ is the $z$-axis position of track $j$ at its closest point to the beamline and $\sigma_j^2$ is its uncertainty.
The track-vertex association matrix $p_{ij}$ maps tracks to their associated vertices, i.e.\ $p_{ij} = 1$ if vertex $i$ and track $j$ are associated, $p_{ij} = 0$ if they are not.
Rather than minimize Eq.~\ref{eq:vtxChi2} directly with an unknown number of vertices, the CMS clustering algorithm~\cite{Speer:2006mh,Chatrchyan:2014fea} uses a technique known as deterministic annealing~\cite{Rose:726788}, which treats the system as a statistical ensemble of associations between the tracks and an unknown number of vertices.
The association matrix $p_{ij}$ is then the probability that vertex $i$ and track $j$ are associated.
If every possible set of assignments, for every possible number and arrangement of vertices, is considered equally probably, this is analogous to a thermodynamic system at high temperature, with $\chi^2$ playing the role of energy.
The system is simulated at high ``temperature'' and the analog of free energy is minimized to determine $p_{ij}$.
The temperature is then lowered in steps, with track-vertex associations deterministic in the limit of zero temperature.

Among the interaction vertices in an event, the one whose associated charged particles have the highest sum of $\pt^2$ is labeled the primary vertex (PV).
A PV must be less than 24\unit{cm} from the nominal beam spot in the $z$ direction and less than 2\unit{cm} from the beamline.



\section{Particle Flow Reconstruction}

The simplest conceivable algorithm would reconstruct each type of particle mostly with information from single subsystems: muons with the outer muon system, electrons and photons with ECAL, jets with the calorimeters aided by inner tracker information to handle $\Pqb$ jet vertexing, etc.
This approach is sufficient for many analyses and sophisticated versions of the general principle have performed admirably at a number of experiments, but it is suboptimal.
It fails to exploit the full detector information for many objects---for example, not using the inner tracker's precise measurements of low-energy charged hadrons in jets made by clustering calorimeter deposits---and misses significant correlations between detector systems.
The CMS collaboration takes a different approach, using a particle flow (PF) algorithm combining subdetector signals for optimal particle reconstruction and identification~\cite{CMS:2009nxa,CMS:2010byl,Sirunyan:2017ulk}.

Several features of CMS facilitate PF reconstruction, as described in Section~\ref{sec:cms}.
The most important is that the calorimeters are inside the magnet and close to the tracker, so charged particles are much less likely to interact with material between them.
The inner tracker's precise position measurement and ECAL's fine segmentation thus allow tracks to be associated to calorimeter clusters even for individual charged hadrons of modest energy.

\subsection{PF Candidates}

The inputs to the PF algorithm are inner tracker tracks, muon system tracks, and clusters of energy deposits in the calorimeters, all of which are calibrated beforehand.
Calorimeter clusters are built independently for each subsystem, with ECAL and HCAL barrel and endcaps considered separately.
Topological clusters are built by combining adjacent cells with energy deposits over a threshold, using cells that are local energy maxima as seeds.
Within the topological clusters, the final calorimeter clusters are built by fitting the energy deposits with the sum of several two-dimensional Gaussians, one Gaussian for each seed in the topological cluster.

The first step of the PF algorithm is to link tracks and clusters across subdetectors.
Tracks are linked to calorimeter clusters by extrapolating from the track to the calorimeter cells the particle would be expected to hit.
To account for bremsstrahlung photons from electron interactions with tracker material, GSF tracks are linked with ECAL clusters compatible with a tangent to the track where it hit the tracker.
Overlapping ECAL and HCAL clusters are linked outside the inner tracker acceptance.
Inner tracks are linked to muon system tracks if they are compatible with each other within the resolution of the muon system.
The groups of linked objects, called ``PF blocks'', usually originate from one or a few particles and are the basic unit of PF reconstruction.

\subsubsection{Muons}

Muon candidates in CMS~\cite{Chatrchyan:2012xi} come in three flavors: ``standalone'', ``tracker'', and ``global'' muons.
Standalone muons use only the track from the muon spectrometer (the ``standalone track''), built with a fit to track segments made of clusters of hits in the DTs, CSCs, and RPCs.
Tracker muons use only the inner track, identified as a muon because the track is compatible with one or more track segments in the muon system.
Global muons use a combined ``global track'' made by fitting the hits in an inner track and a compatible standalone track to a common muon trajectory through the whole detector.
By construction, global muons have corresponding standalone and tracker muons.
The inner track typically dominates the global track fit, so the corresponding tracker muon is merged with the global muon.
When a muon candidate is reconstructed, its constituent tracks are removed from the PF block and are therefore not used in further reconstruction.

\subsubsection{Electrons and Prompt Photons}

Electron reconstruction uses GSF tracks linked with ECAL clusters~\cite{Baffioni:2006cd,Adam:2005bya}.
The cluster associated to a track and the bremsstrahlung candidate clusters on tangents to the track are collectively called the ``supercluster''.
Prompt photons are reconstructed from superclusters without associated tracks except displaced track pairs consistent with $\Pa \to \Pe^+\Pe^-$ conversions in the tracker material~\cite{Khachatryan:2015iwa}.
In both cases, the HCAL energy near the supercluster cannot be more than 10\% of the supercluster energy.
Non-isolated photons, i.e.\ those with substantial nearby tracks or calorimeter deposits or a ratio of ECAL and HCAL energy incompatible with a photon, as assumed to be from $\pi^0$ decays and are described with neutral hadrons in the next section.
Tracks and clusters used to reconstruct electrons and photons are removed from the PF block and are not used in hadron reconstruction.

\subsubsection{Charged and Neutral Hadrons}

With muon, electron, and prompt photon constituents removed, remaining detector signals are taken to be from charged and neutral hadrons (including non-prompt photons)~\cite{CMS:2009nxa,Sirunyan:2017ulk}.
Clusters in ECAL without associated tracks are taken to be photons from $\pi^0$ decays, because neutral hadrons deposit very little energy in ECAL\@.
Trackless clusters in HCAL are taken to be neutral hadrons.
Both are removed from the PF blocks, so all that remain are linked clusters and tracks.
Paired tracks and clusters with compatible energies are taken to be charged hadrons.
If the track {\pt} is much less than the calorimeter-measured {\pt}, the pair is labeled as overlapping charged and neutral hadrons.


\subsection{Jets}

Effective clustering of hadrons, non-prompt photons, and non-prompt leptons into jets is critically important for many physics analyses, including the $\ZZ + \text{jets}$ differential cross section measurements and the {\ZZ} VBS search.
Clustering must be efficient, to ensure the tagging jets in VBS events are found, but the clustering algorithm should not tag spurious jets, as the number of jets in an event is sensitive to higher-order QCD corrections and therefore an interesting quantity to compare to theoretical predictions.
Similarly, the algorithm should not erroneously cluster particles from the same initial parton into multiple jets or merge jets from multiple original partons, because the kinematics of the original quarks and gluons are also of theoretical interest and the detector-level jet kinematics should accurately reflect them.
A clustering algorithm is said to be ``infrared safe'' if the presence of low-energy hadrons from soft gluon radiation does not change the number of jets or have a qualitatively significant effect on jet shapes and kinematics.
This fits with the intuition that a single {1\GeV} pion should have essentially no effect in an event with multiple jets with energies on the order of hundreds of {\GeVns}~\cite{Salam:2007xv}.
An algorithm is said to be ``collinear safe'' if the jets are not changed substantially by splitting one hadron into two nearly collinear hadrons with the same total four-momentum.
This also fits with physical intuition in that jets deposit energy over an area significantly larger than the spatial resolution of the detector, so increasing the detector granularity enough to resolve two very close particles (without changing their total four-momentum) should have little or no effect on the jet.

Infrared and collinear (IRC) safety are critically important for comparing data to theoretical predictions~\cite{Salam:2009jx}.
Collinear splittings and soft gluon radiation during jet fragmentation should not affect the dynamics of the {\TeVns}-scale hard scattering processes we wish to probe, but they are nonperturbative and difficult to model, and experimental analysis can only probe the underlying hard interaction if it is insensitive to this kind of mismodeling.
Experimental detectors' finite resolution and inability to measure arbitrarily soft particles enforces some level of IRC safety on any algorithm, but the results of an analysis methods that uses an IRC unsafe clustering will depend on the complex, detector-dependent details of this partial IRC regularization.
In any case, the most meaningful comparisons between data and theory should use the same definition of a jet in the experimental analysis and the perturbative calculation, and perturbative calculations require IRC safe observables to preserve unitarity.

These considerations, and the desire for conical jets with a well-defined area in the $\eta$-$\phi$ plane, lead most CMS analyses (including this one) to use jets clustered with the anti-{\kt} algorithm~\cite{Cacciari:2008gp,Cacciari:2011ma}.
The anti-{\kt} algorithm defines the distance between two particles $i$ and $j$ as
\begin{equation}
  d_{ij} = \min\left(p_{\text{T}i}^{-2}, p_{\text{T}j}^{-2}\right) \frac{\Delta_{ij}}{R},
\end{equation}
where $\Delta_{ij}$ is the distance in the rapidity-polar angle plane,
\begin{equation}
  \Delta_{ij}^2 \equiv \left(y_i - y_j\right)^2 + \left(\phi_i - \phi_j\right)^2,
\end{equation}
and $R$ is a parameter setting the size of the resulting jets.
The algorithm proceeds iteratively.
At each iteration, if the smallest $d_{ij}$ between any pair of particles in the event is smaller than the smallest $\pt^{-2}$ of any single particle, the particles in the pair are merged into a single particle with their total four-momentum.
If the minimum single-particle $\pt^{-2}$ is smaller than the minimum $d_{ij}$, the single particle is labeled a jet and removed from further consideration.
Iteration proceeds until all particles are part of a jet.
In this analysis, the size parameter used is $R = 0.4$.

Charged hadrons from pileup interactions are not included in jet clustering~\cite{CMS:2014ata}.
The contribution of neutral hadrons from pileup is estimated with a jet area technique~\cite{Khachatryan:2016kdb,Cacciari:2008gn,Cacciari:2007fd} in which the energy density of neutral hadrons from pileup is calculated event-by-event and multiplied by the area of the jet to estimate the neutral pileup contribution, which is subtracted from the jet energy.
Jets in Monte Carlo samples have their energy shifted and stochastically smeared such that the overall energy scale and resolution match that of jets in data~\cite{Chatrchyan:2011ds,Khachatryan:2016kdb}.


\subsection{Missing Transverse Energy}

Neutrinos---or, hypothetically, WIMP dark matter or other new particles that do not decay or interact directly with the detector---escape and cannot be directly measured.
Because the beams have no momentum in the $x$-$y$ plane, the transverse momentum of the visible particles must balance the transverse momentum of the invisible ones.
The missing transverse momentum is thus
\begin{equation}\label{eq:MET}
  \ptvecmiss = -\! \! \sum_\text{visible} \ptvec,
\end{equation}
where the sum runs over the transverse momenta of all PF candidates in the event.
The missing transverse energy, {\MET}, is its magnitude.
The {\MET} is calibrated by propagating the jet energy scale corrections to the {\MET} calculation~\cite{Chatrchyan:2011tn,Khachatryan:2014gga,CMS-PAS-JME-16-004}.
PF candidates originating from pileup interactions are included in the sum in Eq.~\ref{eq:MET} because these soft collisions are very unlikely to produce neutrinos, so including them biases the measurement less than trying to determine which neutral particles should be considered pileup and which should not.
The charged tracks from pileup events are used to correct for the residual bias arising from the slightly lower efficiency for soft neutral particles from pileup.



\section{Object Identification and Selection}

The reconstruction algorithms described above are general purpose in the sense that they can be used in nearly any analysis, but do not address the specific needs of any, so further selections are essentially always required to optimize object efficiency and purity for studying a specific physics process.
The leptons used in this analysis are required to pass identification requirements on top of those imposed during PF reconstruction, and are required to be isolated from other particles in the event, to reject fake objects from jet fragmentation.
Four-lepton processes have low reducible backgrounds, so the selections presented here are generally loose, optimized for high efficiency compared to most CMS analyses.



\subsection{Electrons}

Electron


\subsection{Muons}
even nicer


\subsection{Jets}
not as nice


\subsection{Final State Photon Radiation}
Bit of a mess


\subsection{Misidentified Objects}\label{sec:looseID}
Fake rates



\section{ZZ Candidate and Event Selection}
Explain the different classes of events (full spectrum, Higgs, on shell\ldots)

\subsection{Z Candidate Selection}\label{sec:zSelection}
Mass cuts and lepton pairing


\subsection{ZZ Candidate Selection}
Disambiguation for $>4$ leptons


\subsection{Background Estimation}


\subsection{VBS Signal Selection}\label{sec:vbsSelection}
Dijets and so on
